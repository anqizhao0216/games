<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>game 1-13</title>
    <style media="screen">
      #id-canvas {
        border: 2px black solid;
      }
    </style>
    <script src="util.js" charset="utf-8"></script>
    <script src="guagame.js" charset="utf-8"></script>
    <script src="paddle.js" charset="utf-8"></script>
    <script src="block.js" charset="utf-8"></script>
    <script src="ball.js" charset="utf-8"></script>
  </head>
  <body>
    <canvas id="id-canvas" width="400" height="300"></canvas>
    <canvas id="canvas" width="400" height="300"></canvas>

<script type="text/javascript">
var log = console.log.bind(console)

var __main = function () {
  var game = GuaGame(30)
  var paddle = Paddle()
  var ball = Ball()
  // var block = Block()

  var blocks = []
  for (var i = 0; i < 3; i++) {
    var b = Block()
    //
    b.x = i * 150
    b.y = 50
    blocks.push(b)

  }
  var paused = false
  game.regiserAction('a', function() {
    paddle.moveLeft()
  })
  game.regiserAction('d', function() {
    paddle.moveRight()
  })
  game.regiserAction('f', function() {
    ball.fire()
  })
  window.addEventListener('keydown', function(event) {
    if (event.key == 'p') {
      paused = !paused
    }
  })

  game.update = function() {
    if (paused) {
      return
    }
    ball.move()

    //collide
    if (paddle.collide(ball)) {
      ball.bounce()
    }


    for (var i = 0; i < blocks.length; i++) {
      var block = blocks[i]
      if (block.collide(ball)) {
        log('block')
        block.kill()
        ball.bounce()
      }

    }
    // ball & block collide

  }
  game.draw = function() {
    // draw
    game.drawImage(paddle)
    game.drawImage(ball)
    // draw blocks
    for (var i = 0; i < blocks.length; i++) {
      var block = blocks[i]
      if (block.alive) {
          game.drawImage(block)
      }
    }
  }
}

__main()
</script>
  </body>
</html>
